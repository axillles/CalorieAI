# üí≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Payments –¥–ª—è –±–æ—Ç–∞

## üöÄ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

### 1. **–°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –≤ @BotFather**

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/mybots` –≤ @BotFather
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
3. –ù–∞–∂–º–∏—Ç–µ "Payments"
4. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è **Stripe** –¥–ª—è –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π)
5. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

### 2. **–ü–æ–ª—É—á–∏—Ç—å –ø–ª–∞—Ç–µ–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:
- `PAYMENT_PROVIDER_TOKEN` - —Ç–æ–∫–µ–Ω –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π
- `PAYMENT_PROVIDER_NAME` - –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

### 3. **–î–æ–±–∞–≤–∏—Ç—å –≤ .env —Ñ–∞–π–ª**

```env
# Telegram Payments
PAYMENT_PROVIDER_TOKEN=your_payment_provider_token_here
PAYMENT_PROVIDER_NAME=stripe
```

### 4. **–û–±–Ω–æ–≤–∏—Ç—å config/settings.py**

–î–æ–±–∞–≤—å—Ç–µ –≤ `config/settings.py`:

```python
# Telegram Payments
PAYMENT_PROVIDER_TOKEN = os.getenv("PAYMENT_PROVIDER_TOKEN")
PAYMENT_PROVIDER_NAME = os.getenv("PAYMENT_PROVIDER_NAME", "stripe")
```

### 5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ–¥**

–í `handlers/command_handler.py` –≤ –º–µ—Ç–æ–¥–µ `_handle_subscription_request`:

```python
# –°–æ–∑–¥–∞–µ–º –∏–Ω–≤–æ–π—Å –¥–ª—è –æ–ø–ª–∞—Ç—ã
from telegram import LabeledPrice

prices = [LabeledPrice(plan['name'], int(plan['price'] * 100))]  # –¶–µ–Ω–∞ –≤ —Ü–µ–Ω—Ç–∞—Ö

await context.bot.send_invoice(
    chat_id=query.from_user.id,
    title=plan['name'],
    description=f"–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ {plan['duration_days']} –¥–Ω–µ–π",
    payload=f"subscription_{plan_type}",
    provider_token=settings.PAYMENT_PROVIDER_TOKEN,
    currency=plan['currency'],
    prices=prices,
    start_parameter="subscription_start"
)
```

### 6. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã**

–î–æ–±–∞–≤—å—Ç–µ –≤ `main.py`:

```python
from telegram.ext import PreCheckoutQueryHandler, MessageHandler, filters

# –û–±—Ä–∞–±–æ—Ç–∫–∞ pre-checkout
application.add_handler(PreCheckoutQueryHandler(self.pre_checkout_handler))

# –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
application.add_handler(MessageHandler(filters.SUCCESSFUL_PAYMENT, self.successful_payment_handler))
```

## üí∞ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã:

### **Stripe** (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω
- ‚úÖ –ù–∏–∑–∫–∏–µ –∫–æ–º–∏—Å—Å–∏–∏ (2.9% + $0.30)
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –•–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### **–ÆKassa** (–î–ª—è –†–æ—Å—Å–∏–∏)
- ‚úÖ –ù–∏–∑–∫–∏–µ –∫–æ–º–∏—Å—Å–∏–∏ –¥–ª—è –†–§
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –∫–∞—Ä—Ç
- ‚ùå –¢–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–∑–∏–¥–µ–Ω—Ç–æ–≤ –†–§

### **Payme** (–î–ª—è –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–∞)
- ‚úÖ –ù–∏–∑–∫–∏–µ –∫–æ–º–∏—Å—Å–∏–∏ –¥–ª—è UZ
- ‚ùå –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –≥–µ–æ–≥—Ä–∞—Ñ–∏—è

## üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π:

### **–¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã Stripe:**
- **Visa:** 4242 4242 4242 4242
- **Mastercard:** 5555 5555 5555 4444
- **Expiry:** –õ—é–±–∞—è –±—É–¥—É—â–∞—è –¥–∞—Ç–∞
- **CVC:** –õ—é–±—ã–µ 3 —Ü–∏—Ñ—Ä—ã

### **–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º:**
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –ü–µ—Ä–µ–∫–ª—é—á–∞–π—Ç–µ—Å—å –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üì± UX –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

### **–ü–æ—Å–ª–µ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ —Ñ–æ—Ç–æ:**
1. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–∞–Ω—ã –ø–æ–¥–ø–∏—Å–∫–∏
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –ø–ª–∞–Ω
3. –°–æ–∑–¥–∞–µ—Ç—Å—è –∏–Ω–≤–æ–π—Å –¥–ª—è –æ–ø–ª–∞—Ç—ã
4. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–∫–∞
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ

### **–ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–æ–π:**
- `/subscription` - –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–¥–ø–∏—Å–∫—É
- `/upgrade` - –ø–æ–∫–∞–∑–∞—Ç—å –ø–ª–∞–Ω—ã –ø–æ–¥–ø–∏—Å–∫–∏
- `/cancel` - –æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É

## üö® –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ –ø–ª–∞—Ç–µ–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–¥–µ
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç–∞—Ö
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –ø–ª–∞—Ç–µ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
5. **–í–æ–∑–≤—Ä–∞—Ç—ã:** –ü—Ä–æ–¥—É–º–∞–π—Ç–µ –ø–æ–ª–∏—Ç–∏–∫—É –≤–æ–∑–≤—Ä–∞—Ç–æ–≤

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞:

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–æ–≤
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

---

**–ì–æ—Ç–æ–≤–æ!** –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞—à –±–æ—Ç —Å–º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏ –∑–∞ –ø–æ–¥–ø–∏—Å–∫–∏! üéâ
